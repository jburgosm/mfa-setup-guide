<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innovatio - MFA Setup Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <!-- Chosen Palette: "Modern & Secure" - A palette of deep blues, grays, and a soft white, with a vibrant cyan for a modern, tech-focused feel. This palette conveys security and professionalism. -->
    <!-- Application Structure Plan: The application is structured as a single-page, vertical-scrolling interactive checklist. This task-oriented design transforms the static SOP into a guided, step-by-step process. Key sections include an an interactive "Prerequisites & Responsibilities" accordion, user info fields, the core multi-step procedure with checkboxes that update a master progress bar, and a final resources section. This structure was chosen to reduce cognitive load, improve user engagement, and make a technical procedure feel more manageable and less intimidating than a dense document. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Core MFA setup procedure -> Goal: Guide user through a task -> Viz/Presentation: Interactive checklist with visual icons (HTML/CSS/Unicode) and a dynamic progress bar. -> Interaction: User clicks checkboxes upon completing a step, which updates the progress bar via JavaScript. -> Justification: This provides clear visual feedback of progress, breaking the task into digestible chunks and making the user feel a sense of accomplishment, which is more effective for procedural instructions than static text.
        - Report Info: Responsibilities & Definitions -> Goal: Inform without cluttering the main flow -> Viz/Presentation: Accordion/collapsible sections. -> Interaction: User clicks to expand and view details. -> Justification: This keeps the main interface clean and focused on the primary task, while making secondary information easily accessible on demand.
        - Library/Method: Vanilla JavaScript for all interactions. Tailwind CSS for styling.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        .step-card {
            transition: all 0.3s ease-in-out;
        }
        .step-card.completed {
            border-left-color: #4ade80; /* green-400 */
            background-color: #f0fdf4; /* green-50 */
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .report-overlay {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.5s linear;
        }
        .report-overlay.visible {
            visibility: visible;
            opacity: 1;
        }
        .message-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 100;
            display: none; /* Initially hidden */
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
        
        <header class="text-center mb-8 bg-white rounded-xl shadow-md p-6 flex justify-center items-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mr-4">Innovatio Software</h1>
            <!-- The logo has been added to the right of the heading -->
            <img src="https://cdn.prod.website-files.com/65e3ba3f9c78c7ed6fcc0529/66be1ebc46b209ba3baece3c_Logo_Innovatio_Circle-p-500.png" alt="Innovatio Circle Logo" class="h-12 w-12 rounded-full shadow-lg">
        </header>

        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-2xl font-bold mb-3 text-gray-900">Purpose of this Guide</h2>
            <p class="text-gray-600">This interactive guide establishes the standard procedure for all Innovatio employees to configure the Microsoft Authenticator mobile app. Implementing Multi-Factor Authentication (MFA) is a mandatory security measure designed to protect company assets and your personal data from unauthorized access.</p>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-2xl font-bold mb-3 text-gray-900">Your Information</h2>
            <p class="text-gray-600 mb-4">Please enter your information to be included in the completion report.</p>
            <div class="space-y-4">
                <div>
                    <label for="userName" class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="userName" placeholder="John Doe" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2">
                </div>
                <div>
                    <label for="userEmail" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="userEmail" placeholder="john.doe@innovatio.com" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2">
                </div>
            </div>
        </div>
        
        <!-- The Prerequisites & Responsibilities section is now static -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h3 class="text-2xl font-bold mb-3 text-gray-900">Prerequisites & Responsibilities</h3>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <h4 class="font-bold text-gray-800">Your Responsibilities</h4>
                    <ul class="list-disc list-inside text-gray-600 mt-2 space-y-1">
                        <li>Follow the steps outlined in this guide.</li>
                        <li>Report any issues to Innovation IT.</li>
                        <li>Keep your mobile device secure.</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-gray-800">Innovation IT Responsibilities</h4>
                    <ul class="list-disc list-inside text-gray-600 mt-2 space-y-1">
                        <li>Provide technical support during setup.</li>
                        <li>Troubleshoot and resolve any issues.</li>
                        <li>Manage MFA settings for all accounts.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="sticky top-0 z-10 py-4 bg-gray-50/80 backdrop-blur-sm mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Your Setup Progress</h3>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <!-- Changed progress bar color to a shade of green -->
                <div id="progressBar" class="bg-green-600 h-4 rounded-full progress-bar-fill" style="width: 0%"></div>
            </div>
            <p id="progressText" class="text-right text-sm text-gray-600 mt-1">0% Complete</p>
        </div>

        <main class="space-y-6">
            
            <div id="step-1" class="step-card bg-white p-6 rounded-xl shadow-md border-l-4 border-gray-200">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <!-- Changed checkbox color to a shade of green -->
                        <input id="checkbox-1" type="checkbox" class="h-6 w-6 text-green-600 border-gray-300 rounded focus:ring-green-500 step-checkbox">
                    </div>
                    <div class="ml-4">
                        <h3 class="text-xl font-bold text-gray-900">Step 1: Install the Microsoft Authenticator App</h3>
                        <p class="text-gray-600 mt-2">On your mobile device, download and install the official Microsoft Authenticator application from your device's app store.</p>
                        <div class="mt-4 flex flex-col sm:flex-row gap-4">
                            <a href="https://apps.apple.com/us/app/microsoft-authenticator/id983156458" target="_blank" class="flex items-center justify-center gap-2 bg-gray-900 text-white py-2 px-4 rounded-lg font-semibold w-full sm:w-auto hover:bg-gray-800 transition-colors">
                                <span></span> App Store
                            </a>
                            <a href="https://play.google.com/store/apps/details?id=com.azure.authenticator" target="_blank" class="flex items-center justify-center gap-2 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-semibold w-full sm:w-auto hover:bg-gray-300 transition-colors">
                                ▶ Google Play
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-2" class="step-card bg-white p-6 rounded-xl shadow-md border-l-4 border-gray-200">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <!-- Changed checkbox color to a shade of green -->
                        <input id="checkbox-2" type="checkbox" class="h-6 w-6 text-green-600 border-gray-300 rounded focus:ring-green-500 step-checkbox">
                    </div>
                    <div class="ml-4">
                        <h3 class="text-xl font-bold text-gray-900">Step 2: Initiate Setup on Your Computer</h3>
                        <p class="text-gray-600 mt-2">On your computer, open a web browser and navigate to <a href="https://portal.office.com" target="_blank" class="text-green-600 font-semibold hover:underline">portal.office.com</a>. Log in with your Innovatio credentials. When prompted for more security information, click 'Next' to display a unique QR code on your screen. Keep this window open.</p>
                    </div>
                </div>
            </div>

            <div id="step-3" class="step-card bg-white p-6 rounded-xl shadow-md border-l-4 border-gray-200">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <!-- Changed checkbox color to a shade of green -->
                        <input id="checkbox-3" type="checkbox" class="h-6 w-6 text-green-600 border-gray-300 rounded focus:ring-green-500 step-checkbox">
                    </div>
                    <div class="ml-4">
                        <h3 class="text-xl font-bold text-gray-900">Step 3: Link Your Account to the App</h3>
                        <p class="text-gray-600 mt-2">Open the Authenticator app on your phone. Tap the '+' icon to add an account, select 'Work or school account', and then choose 'Scan a QR code'. Use your phone's camera to scan the QR code displayed on your computer screen.</p>
                        <div class="mt-4 p-4 bg-gray-100 rounded-lg flex items-center justify-center gap-4 text-gray-500">
                            <div class="text-6xl">📱</div>
                            <div class="text-2xl font-mono">→ → →</div>
                            <div class="w-24 h-24 bg-white p-2 rounded-md flex items-center justify-center">
                                <div class="grid grid-cols-3 gap-1">
                                    <div class="w-6 h-6 bg-gray-800"></div><div class="w-6 h-6 bg-gray-800"></div><div class="w-6 h-6 bg-gray-800"></div>
                                    <div class="w-6 h-6 bg-gray-800"></div><div class="w-6 h-6 bg-white"></div><div class="w-6 h-6 bg-gray-800"></div>
                                    <div class="w-6 h-6 bg-gray-800"></div><div class="w-6 h-6 bg-gray-800"></div><div class="w-6 h-6 bg-gray-800"></div>
                                </div>
                            </div>
                            <div class="text-2xl font-mono">→ → →</div>
                            <div class="text-6xl">💻</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-4" class="step-card bg-white p-6 rounded-xl shadow-md border-l-4 border-gray-200">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <!-- Changed checkbox color to a shade of green -->
                        <input id="checkbox-4" type="checkbox" class="h-6 w-6 text-green-600 border-gray-300 rounded focus:ring-green-500 step-checkbox">
                    </div>
                    <div class="ml-4">
                        <h3 class="text-xl font-bold text-gray-900">Step 4: Finalize and Verify</h3>
                        <p class="text-gray-600 mt-2">Return to your computer and click 'Next'. A test notification will be sent to your phone. Open the notification and tap 'Approve'. Once verified, you have successfully set up MFA! We highly recommend adding a backup phone number if prompted.</p>
                    </div>
                </div>
            </div>

            <!-- Warning message added here -->
            <div id="warningMessage" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg" role="alert">
                <p class="font-bold">Heads up!</p>
                <p id="warningText">Please complete all the required steps before finishing the guide.</p>
            </div>

            <!-- Finish button to trigger the check -->
            <div class="flex justify-center mt-8">
                <button id="finishButton" class="bg-cyan-600 text-white font-semibold py-3 px-8 rounded-lg shadow-lg hover:bg-cyan-700 transition-colors">
                    Finish Guide
                </button>
            </div>


            <div id="report-modal" class="report-overlay fixed inset-0 flex items-center justify-center z-50 p-4" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full text-center relative">
                    <!-- Updated the GIF URL here -->
                    <div class="flex justify-center mb-4">
                        <img src="https://gifdb.com/images/high/stone-cold-beer-498-x-498-gif-zfpaf7zwjhckia6s.gif" alt="Celebration GIF" class="rounded-lg w-32 h-32 object-cover">
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Congratulations!</h2>
                    <p class="text-gray-600 mb-2">You have successfully completed the Multi-Factor Authentication setup. Your account is now more secure.</p>
                    <div class="border-t border-gray-200 mt-4 pt-4 text-left">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Completion Report</h3>
                        <p class="text-sm text-gray-600">**Name:** <span id="reportName" class="font-semibold"></span></p>
                        <p class="text-sm text-gray-600 mt-1">**Email:** <span id="reportEmail" class="font-semibold"></span></p>
                    </div>
                    <div class="flex flex-col items-center mt-6 gap-4">
                         <!-- New text explaining the purpose of the email report -->
                         <p class="text-sm text-gray-600">To finalize your setup and notify IT, please click "Send Report via Email." This email contains your name and email, confirming your successful completion of the guide for our records.</p>
                         <!-- Converted the email link into a button for JavaScript control -->
                         <button id="emailButton" type="button" class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors w-full sm:w-auto">
                            Send Report via Email
                        </button>
                        <button id="resetButton" class="bg-gray-200 text-gray-800 font-semibold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors w-full sm:w-auto">
                            Restart Guide
                        </button>
                    </div>
                </div>
            </div>

            <!-- New confirmation modal for email sent -->
            <div id="email-confirm-modal" class="message-modal">
                <p class="text-center font-semibold text-gray-800">Email Report Sent!</p>
            </div>

        </main>
        
        <footer class="mt-10 pt-6 border-t border-gray-200">
            <h3 class="text-xl font-bold text-gray-900">Need Help?</h3>
            <p class="text-gray-600 mt-2">If you encounter any issues, please refer to the resources below or contact Innovation IT for assistance.</p>
            <div class="mt-4 space-y-2">
                <!-- Changed link colors to a shade of green -->
                <a href="https://www.youtube.com/watch?v=HDseXZWVQ8s" target="_blank" class="text-green-600 font-semibold hover:underline block">▶ Watch a Video Tutorial</a>
                <a href="https://support.microsoft.com/en-us/office/set-up-your-microsoft-365-sign-in-for-multi-factor-authentication-ace1d096-61e5-449b-a875-58eb3d74de14" target="_blank" class="text-green-600 font-semibold hover:underline block">📄 Read the Official Microsoft Guide</a>
            </div>
            <!-- Added a section to display the user ID for debugging and identification -->
            <p class="text-xs text-gray-400 mt-4">
                Your User ID: <span id="userIDDisplay">Loading...</span>
            </p>
        </footer>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, runTransaction, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // GLOBAL VARIABLES from Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let userId;

        /**
         * Initializes Firebase and sets up the user authentication.
         */
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                if (authToken) {
                    await signInWithCustomToken(auth, authToken);
                } else {
                    await signInAnonymously(auth);
                }
                userId = auth.currentUser?.uid || crypto.randomUUID();
                console.log("Firebase initialized and user signed in:", userId);

                // Display the user ID after authentication is complete
                document.getElementById('userIDDisplay').textContent = userId;

            } catch (error) {
                console.error("Error initializing Firebase:", error);
            }
        }

        /**
         * Safely increments the specified counter in the database using a transaction.
         * Using a transaction ensures that concurrent updates from multiple users won't overwrite each other,
         * making the counter reliable.
         * @param {string} counterName The name of the counter to increment ('completions' or 'resets').
         */
        async function incrementCounter(counterName) {
            if (!db) {
                console.error("Firestore is not initialized.");
                return;
            }
            // The Firestore path for public data needs to have an even number of segments.
            // This path is set up to store public statistics for the app.
            const docRef = doc(db, `/artifacts/${appId}/public/data/stats/completionStats`);
            
            try {
                await runTransaction(db, async (transaction) => {
                    const docSnap = await transaction.get(docRef);
                    if (!docSnap.exists()) {
                        transaction.set(docRef, { [counterName]: 1 });
                    } else {
                        const newCount = (docSnap.data()[counterName] || 0) + 1;
                        transaction.update(docRef, { [counterName]: newCount });
                    }
                });
                console.log(`Successfully incremented ${counterName}.`);
            } catch (e) {
                console.error("Transaction failed: ", e);
            }
        }

        /**
         * Saves the current state of checked checkboxes to local storage.
         */
        function saveProgress() {
            const checkedSteps = Array.from(document.querySelectorAll('.step-checkbox:checked')).map(cb => cb.id);
            localStorage.setItem('mfaGuideProgress', JSON.stringify(checkedSteps));
        }

        /**
         * Loads the saved progress from local storage and updates the checkboxes.
         */
        function loadProgress() {
            const savedProgress = localStorage.getItem('mfaGuideProgress');
            if (savedProgress) {
                const checkedSteps = JSON.parse(savedProgress);
                checkedSteps.forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
            }
        }
        
        // Core application logic
        document.addEventListener('DOMContentLoaded', function () {
            const checkboxes = document.querySelectorAll('.step-checkbox');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const reportModal = document.getElementById('report-modal');
            const resetButton = document.getElementById('resetButton');
            const emailButton = document.getElementById('emailButton');
            const userNameInput = document.getElementById('userName');
            const userEmailInput = document.getElementById('userEmail');
            const reportNameSpan = document.getElementById('reportName');
            const reportEmailSpan = document.getElementById('reportEmail');
            const finishButton = document.getElementById('finishButton');
            const warningMessage = document.getElementById('warningMessage');
            const warningText = document.getElementById('warningText');
            const emailConfirmModal = document.getElementById('email-confirm-modal');
            const totalSteps = checkboxes.length;

            /**
             * Function to display a temporary message modal.
             * @param {string} message The message to display.
             */
            function showMessageModal(message) {
                const modal = document.getElementById('email-confirm-modal');
                modal.textContent = message;
                modal.style.display = 'block';
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 3000); // Hide after 3 seconds
            }

            /**
             * Fires a confetti effect.
             */
            function launchConfetti() {
                const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
                function fire(particleRatio, opts) {
                    confetti(Object.assign({}, defaults, opts, {
                        particleCount: Math.floor(200 * particleRatio)
                    }));
                }
                fire(0.25, {
                    spread: 26,
                    decay: 0.9,
                    gravity: 0.5,
                    scalar: 1.2,
                    startVelocity: 45,
                    origin: { x: 0.5, y: 0.8 }
                });
                fire(0.2, {
                    spread: 60,
                    decay: 0.9,
                    gravity: 0.5,
                    scalar: 1.2,
                    startVelocity: 45,
                    origin: { x: 0.5, y: 0.8 }
                });
                fire(0.35, {
                    spread: 100,
                    decay: 0.9,
                    gravity: 0.5,
                    scalar: 1.2,
                    startVelocity: 45,
                    origin: { x: 0.5, y: 0.8 }
                });
                fire(0.1, {
                    spread: 120,
                    decay: 0.9,
                    gravity: 0.5,
                    scalar: 1.2,
                    startVelocity: 45,
                    origin: { x: 0.5, y: 0.8 }
                });
            }

            function updateProgress() {
                const checkedCount = document.querySelectorAll('.step-checkbox:checked').length;
                const percentage = totalSteps > 0 ? (checkedCount / totalSteps) * 100 : 0;
                
                progressBar.style.width = percentage + '%';
                progressText.textContent = Math.round(percentage) + '% Complete';

                checkboxes.forEach(checkbox => {
                    const stepCard = checkbox.closest('.step-card');
                    if (checkbox.checked) {
                        stepCard.classList.add('completed');
                    } else {
                        stepCard.classList.remove('completed');
                    }
                });

                // Check for completion and trigger confetti and modal
                if (checkedCount === totalSteps && reportModal.classList.contains('hidden')) {
                    launchConfetti();
                }

                saveProgress();
            }

            function resetGuide() {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                userNameInput.value = '';
                userEmailInput.value = '';
                localStorage.removeItem('mfaGuideProgress'); // Clear local storage on reset
                updateProgress();
            }

            // Simple email validation using a regular expression
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateProgress);
            });
            
            // Handle the finish button click with validation
            finishButton.addEventListener('click', function() {
                const checkedCount = document.querySelectorAll('.step-checkbox:checked').length;
                const name = userNameInput.value.trim();
                const email = userEmailInput.value.trim();

                if (checkedCount < totalSteps) {
                    warningText.textContent = 'Please complete all the required steps before finishing the guide.';
                    warningMessage.classList.remove('hidden');
                } else if (name === '' || !isValidEmail(email)) {
                    warningText.textContent = 'Please enter a valid name and email address.';
                    warningMessage.classList.remove('hidden');
                } else {
                    warningMessage.classList.add('hidden');
                    reportNameSpan.textContent = name;
                    reportEmailSpan.textContent = email;
                    reportModal.classList.add('visible');
                }
            });

            // Increment the reset counter and reset the guide
            resetButton.addEventListener('click', function() {
                incrementCounter('resets');
                resetGuide();
                reportModal.classList.remove('visible'); // Hide the modal when resetting
            });
            
            emailButton.addEventListener('click', function() {
                const name = userNameInput.value || 'N/A';
                const email = userEmailInput.value || 'N/A';
                const recipient = 'support@vnetsmart.com';
                const subject = encodeURIComponent('MFA Setup Guide Completion Report');
                const body = encodeURIComponent(`This is an automated report confirming the completion of the MFA Setup Guide. The user has successfully completed the MFA setup.\n\nUser Name: ${name}\nUser Email: ${email}`);
                const mailtoUrl = `mailto:${recipient}?subject=${subject}&body=${body}`;

                window.open(mailtoUrl, '_blank');
                
                // Increment completion counter and reset the guide after email is sent
                incrementCounter('completions');
                reportModal.classList.remove('visible');
                resetGuide();
                showMessageModal('Email Report Sent!');
            });

            // Load saved progress and initialize Firebase when the page is ready
            loadProgress();
            updateProgress();
            initializeFirebase();
        });
    </script>
</body>
</html>
